# Mirror-Peptidizer

**Mirror-Peptidizer** is a modular pipeline for designing de novo D-peptides, integrating AI-driven tools like Chroma and ProteinMPNN to provide stereoisomer-specific peptide design with enhanced precision. The pipeline is tailored for generating D-peptides that bind effectively to target proteins, offering a streamlined approach that combines binder pose generation and sequence prediction in a cohesive workflow.

This approach leverages stereoisomer-specific modeling and sequence generation for D-peptides, aiming to improve binding accuracy and efficiency over traditional simulation and docking techniques.

```plaintext
+---------------------------+
|       Target Preparation  |
|---------------------------|
|  Invert target PDB along  |
|  X-axis to create the D-  |
|  form target.             |
+---------------------------+
             |
             v
+---------------------------+
|    Binder Pose Generation |
|---------------------------|
|  Use Chroma to generate   |
|  an L-peptide backbone    |
|  constrained to bind to   |
|  the D-form target.       |
+---------------------------+
             |
             v
+---------------------------+
|    Sequence Prediction    |
|---------------------------|
|  Apply ProteinMPNN to     |
|  predict amino acid       |
|  sequence on the L-peptide|
|  backbone.                |
+---------------------------+
             |
             v
+---------------------------+
|    Reversion for Final    |
|    D-Peptide Binder       |
|---------------------------|
|  Convert D-target and L-  |
|  peptide back to original |
|  forms, resulting in      |
|  L-target with D-peptide  |
|  binder.                  |
+---------------------------+
```

## How It Works

1. **Target Preparation**: The pipeline starts by taking the provided receptor's PDB structure, inverting it along the X-axis to create the D-form of the target protein.
2. **Binder Pose Generation with Chroma**: Using the D-form target, Chroma generates an L-peptide binder backbone. This process is constrained by the target’s structure, ensuring an optimized binding interaction.
3. **Sequence Prediction with ProteinMPNN**: The generated L-peptide backbone undergoes sequence prediction via ProteinMPNN to establish a specific amino acid sequence for the binder.
4. **Reversion for Final D-Peptide Binder**: Finally, the D-target and the L-peptide are converted back to their original forms, resulting in an L-target with a D-peptide binder.

## Features

- **Stereoisomer Conversion**: Automatically transforms proteins between L and D forms.
- **AI-Driven Binder Generation**: Uses Chroma's diffusion model to create optimized peptide binder structures.
- **Protein Sequence Prediction**: Predicts sequences tailored for binding using ProteinMPNN, ensuring compatibility with generated binding poses.

## Table of Contents

- [Installation](#installation)
- [Usage](#usage)
- [Project Structure](#project-structure)
- [Configuration](#configuration)

## Installation

### 1. Clone the Repository

```bash
git clone https://github.com/dahuilangda/Mirror-Peptidizer.git
cd Mirror-Peptidizer
```

### 2. Install Required Packages

Set up the Python environment with `mamba` and `pip`:

```bash
mamba create -n dpep python=3.10
mamba install -c conda-forge biopython scikit-learn==1.1.2 pdbfixer
mamba install -c conda-forge matplotlib seaborn
pip install generate-chroma -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install python-dotenv -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 3. Set Up Environment Variables

Copy the example `.env` file and edit it with your Chroma API key and ProteinMPNN checkpoint path:

```bash
cp env_example .env
```

Update `.env` with:

```plaintext
CHROMA_KEY=your_chroma_api_key_here
ProteinMPNN_CHECKPOINT=/path/to/your/proteinmpnn/checkpoint
```

Replace `your_chroma_api_key_here` with your Chroma API key, and `/path/to/your/proteinmpnn/checkpoint` with your ProteinMPNN checkpoint path.

## Usage

Run the Mirror-Peptidizer pipeline with the following command:

```bash
python run_design.py --receptor data/4LWV.pdb --output output_dir --len_binder 11 --temperature 0.1 --num_poses 3 --num_seqs_per_pose 10 --gpu 0
```

### Command-line Arguments

- `--receptor`: Path to the receptor's PDB file (e.g., `data/4LWV.pdb`).
- `--output`: Output directory for the generated files (e.g., `output_dir`).
- `--len_binder`: Length of the peptide binder (default: `11`).
- `--temperature`: Temperature parameter for ProteinMPNN (default: `0.1`).
- `--num_poses`: Number of binding poses generated by Chroma (default: `3`).
- `--num_seqs_per_pose`: Number of sequences generated per pose (default: `10`).

## Project Structure

```
Mirror-Peptidizer/
│
├── __init__.py
├── utils/
│   ├── __init__.py
│   ├── pdb_processing.py
│   ├── chroma_sample.py
│   └── protein_mpnn.py
├── run_design.py
└── env_example
```

- **run_design.py**: Script to execute the full pipeline from the command line.
- **utils/**: Contains modules for PDB processing, Chroma sampling, and ProteinMPNN sequence generation.
- **env_example**: Template file for environment variables.

## Configuration

Ensure these environment variables are set in your `.env` file:

- `CHROMA_KEY`: Chroma API key.
- `ProteinMPNN_CHECKPOINT`: Path to ProteinMPNN checkpoint file.

Refer to these repositories for additional resources:

- [ProteinMPNN GitHub](https://github.com/dauparas/ProteinMPNN)
- [Chroma GitHub](https://github.com/generatebio/chroma)